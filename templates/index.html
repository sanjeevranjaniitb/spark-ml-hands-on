<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark ML Big Data Predictions Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .stats-bar { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px; margin-bottom: 30px; color: white; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; text-align: center; }
        .stat-item h3 { font-size: 2em; margin-bottom: 5px; }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .prediction-card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .prediction-card h2 { color: #333; margin-bottom: 15px; font-size: 1.5em; }
        .prediction-card p { color: #666; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .predict-btn { width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s; }
        .predict-btn:hover { transform: translateY(-2px); }
        .result { margin-top: 20px; padding: 20px; border-radius: 8px; display: none; }
        .result.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .result.warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .result.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .result h3 { margin-bottom: 10px; }
        .about-section { grid-column: 1 / -1; background: white; border-radius: 15px; padding: 30px; margin-top: 30px; }
        .about-section h2 { color: #333; margin-bottom: 20px; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .feature-item { padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea; }
        .loading { display: none; text-align: center; margin: 10px 0; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; } .header h1 { font-size: 2em; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Spark ML Big Data Predictions</h1>
            <p>Real-time Machine Learning predictions on 2,500+ record datasets</p>
        </div>

        <div class="stats-bar">
            <div class="stats-grid" id="stats-grid">
                <div class="stat-item">
                    <h3 id="churn-records">2,500</h3>
                    <p>Churn Records</p>
                </div>
                <div class="stat-item">
                    <h3 id="housing-records">2,500</h3>
                    <p>Housing Records</p>
                </div>
                <div class="stat-item">
                    <h3 id="rating-records">2,500</h3>
                    <p>Rating Records</p>
                </div>
                <div class="stat-item">
                    <h3 id="churn-rate">20.3%</h3>
                    <p>Churn Rate</p>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="prediction-card">
                <h2>Customer Churn Prediction</h2>
                <p>Predict customer churn probability using Logistic Regression</p>
                
                <div class="form-group">
                    <label for="churn-age">Age (18-80):</label>
                    <input type="number" id="churn-age" min="18" max="80" value="35">
                </div>
                
                <div class="form-group">
                    <label for="churn-salary">Annual Salary ($):</label>
                    <input type="number" id="churn-salary" min="25000" max="150000" value="75000" step="1000">
                </div>
                
                <div class="form-group">
                    <label for="churn-gender">Gender:</label>
                    <select id="churn-gender">
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                    </select>
                </div>
                
                <button class="predict-btn" onclick="predictChurn()">Predict Churn Risk</button>
                <div class="loading" id="churn-loading"><div class="spinner"></div><p>Analyzing...</p></div>
                <div id="churn-result" class="result"></div>
            </div>

            <div class="prediction-card">
                <h2>House Price Prediction</h2>
                <p>Estimate property value using Linear Regression</p>
                
                <div class="form-group">
                    <label for="house-rooms">Number of Rooms:</label>
                    <input type="number" id="house-rooms" min="1" max="8" value="3">
                </div>
                
                <div class="form-group">
                    <label for="house-area">Area (sq ft):</label>
                    <input type="number" id="house-area" min="500" max="4000" value="2000" step="50">
                </div>
                
                <div class="form-group">
                    <label for="house-age">Property Age (years):</label>
                    <input type="number" id="house-age" min="0" max="50" value="10">
                </div>
                
                <button class="predict-btn" onclick="predictHousePrice()">Predict Price</button>
                <div class="loading" id="house-loading"><div class="spinner"></div><p>Calculating...</p></div>
                <div id="house-result" class="result"></div>
            </div>
        </div>

        <div class="about-section">
            <h2>Big Data ML Architecture</h2>
            <p>This demo showcases production-ready machine learning using Apache Spark on substantial datasets (2,500+ records each). The system demonstrates how Spark ML scales from local development to enterprise big data environments.</p>
            
            <div class="features-grid">
                <div class="feature-item">
                    <h4>Distributed Processing</h4>
                    <p>Spark ML automatically distributes computation across multiple cores and can scale to clusters with thousands of nodes.</p>
                </div>
                <div class="feature-item">
                    <h4>Feature Engineering</h4>
                    <p>Automated feature transformation pipelines with StringIndexer, OneHotEncoder, and VectorAssembler for production ML.</p>
                </div>
                <div class="feature-item">
                    <h4>Model Persistence</h4>
                    <p>Trained models can be saved and loaded for real-time predictions in production environments.</p>
                </div>
                <div class="feature-item">
                    <h4>Scalable Algorithms</h4>
                    <p>Logistic Regression, Linear Regression, K-Means, and ALS algorithms optimized for big data processing.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load statistics on page load
        window.onload = function() {
            loadStats();
        };

        async function loadStats() {
            try {
                const response = await fetch('/stats');
                const data = await response.json();
                
                document.getElementById('churn-records').textContent = data.datasets.churn.records.toLocaleString();
                document.getElementById('housing-records').textContent = data.datasets.housing.records.toLocaleString();
                document.getElementById('rating-records').textContent = data.datasets.ratings.records.toLocaleString();
                document.getElementById('churn-rate').textContent = (data.datasets.churn.churn_rate * 100).toFixed(1) + '%';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function predictChurn() {
            const age = parseInt(document.getElementById('churn-age').value);
            const salary = parseInt(document.getElementById('churn-salary').value);
            const gender = document.getElementById('churn-gender').value;
            
            const loadingDiv = document.getElementById('churn-loading');
            const resultDiv = document.getElementById('churn-result');
            
            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('/predict/churn', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ age, salary, gender })
                });
                
                const result = await response.json();
                const churnProb = result.churn_probability * 100;
                const willChurn = result.prediction === 1;
                
                resultDiv.innerHTML = `
                    <h3>Prediction Result</h3>
                    <p><strong>Churn Risk:</strong> ${willChurn ? 'HIGH RISK' : 'LOW RISK'}</p>
                    <p><strong>Churn Probability:</strong> ${churnProb.toFixed(1)}%</p>
                    <p><strong>Confidence:</strong> ${(Math.max(churnProb, 100-churnProb)).toFixed(1)}%</p>
                    <p><em>Model trained on ${document.getElementById('churn-records').textContent} customer records</em></p>
                `;
                
                resultDiv.className = 'result ' + (willChurn ? 'error' : 'success');
                
            } catch (error) {
                resultDiv.innerHTML = '<h3>Error</h3><p>Failed to make prediction. Please try again.</p>';
                resultDiv.className = 'result error';
            } finally {
                loadingDiv.style.display = 'none';
                resultDiv.style.display = 'block';
            }
        }

        async function predictHousePrice() {
            const rooms = parseInt(document.getElementById('house-rooms').value);
            const area = parseInt(document.getElementById('house-area').value);
            const age = parseInt(document.getElementById('house-age').value);
            
            const loadingDiv = document.getElementById('house-loading');
            const resultDiv = document.getElementById('house-result');
            
            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('/predict/house', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ rooms, area, age })
                });
                
                const result = await response.json();
                const price = result.prediction;
                const pricePerSqft = result.price_per_sqft;
                
                resultDiv.innerHTML = `
                    <h3>Price Estimate</h3>
                    <p><strong>Predicted Price:</strong> $${price.toLocaleString('en-US', {maximumFractionDigits: 0})}</p>
                    <p><strong>Price per sq ft:</strong> $${pricePerSqft.toFixed(0)}</p>
                    <p><strong>Property Details:</strong> ${rooms} rooms, ${area.toLocaleString()} sq ft, ${age} years old</p>
                    <p><em>Model trained on ${document.getElementById('housing-records').textContent} property records</em></p>
                `;
                
                resultDiv.className = 'result success';
                
            } catch (error) {
                resultDiv.innerHTML = '<h3>Error</h3><p>Failed to make prediction. Please try again.</p>';
                resultDiv.className = 'result error';
            } finally {
                loadingDiv.style.display = 'none';
                resultDiv.style.display = 'block';
            }
        }
    </script>
</body>
</html>